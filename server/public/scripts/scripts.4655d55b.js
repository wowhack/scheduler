"use strict";angular.module("schedulerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("schedulerApp").controller("MainCtrl",["$http","$window","$scope","$routeParams","$resource","$cookies","$modal",function(a,b,c,d,e,f,g){function h(){var b=++j;setTimeout(function(){if(b===j){f.transportationMethod=c.transportationMethod,f.artistSize=c.artistSize;var e="http://localhost:8888/activities?mode="+c.transportationMethod+"&popularity="+c.artistSize+"&preferred="+c.preferredConcerts.map(function(a){return a["artist-id"]}).join(","),g=d.access_token;g&&(e+="&accessToken="+g),c.loading=!0,a({method:"GET",url:e}).success(function(a){b===j&&(c.loading=!1,c.activities=a)}).error(function(a,b,c,d){console.log("ERROR",a,b,c,d)})}},500)}c.transportationMethod=f.transportationMethod||"walking",c.artistSize=f.artistSize||500,c.artists=[],c.loading=!0;var i=e("http://localhost:8888/concerts").get();c.preferredConcerts=[],c.removePreferredConcert=function(a){c.preferredConcerts=c.preferredConcerts.filter(function(b){return b["artist-id"]!==a})},c.openPreferredConcertAdder=function(){var a=g.open({templateUrl:"preferredConcertsAdder.html",controller:"ModalInstanceCtrl",size:"lg",resolve:{concerts:function(){return i.concerts.filter(function(a){var b=!1;return c.preferredConcerts.forEach(function(c){a["artist-id"]===c["artist-id"]&&(b=!0)}),!b})}}});a.result.then(function(a){c.preferredConcerts.push(a)},function(){})};var j=0;h(),["artistSize","transportationMethod","preferredConcerts.length"].forEach(function(a){c.$watch(a,h)}),c.loginToSpotify=function(){var a=encodeURIComponent(b.location.href)+"{?}";b.location.href="http://localhost:8888/login?redirect="+a}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance","concerts",function(a,b,c){a.concerts=c,a.select=function(a){b.close(a)},a.dismiss=function(){b.dismiss("dismiss")}}]);